1、如何避免计算机表示数字的方式引起奇怪的数字方式

2、小窍门优化C代码

3、如何充分利用现代处理器和存储器

4、编译器如何实现过程调用

5、避免缓存溢出

6、编写 unix shell

7、动态存储分配包

8、并发的希望和陷阱

9、位：0 | 1

10、字节：八个位，字节表示文本字符

11、现代一般用ASCII码表示文本字符，如 c 是99

12、程序以字节排序存储在系统，每个字节都有一个整数值，例如上面的99

13、文本行的\n

14、只由ASCII码组成的文件称为文本文件

15、区分不同数据对象的唯一方法是读到这些文件时候的上下文，不同上下文，同样的字节序列代表的可能是整数，浮点数，字符串或者机械指令

16、翻译程序，c语句被转化成低级机器语言指令，指令按照“可执行程序”的格式打包好，并以二进制磁盘文件的形式存放起来。

gcc -o hello hello.c

gcc编译器驱动程序读取程序源文件hello.c，翻译成可执行目标文件hello

17、上述过程

hello.c ->(预处理器cpp) -> hello.i -> (编译器ccl) -> hello.s -> (汇编器as) -> hello.o（二进制），printf.o -> (链接器ld) -> hello

预处理器，例如将include的代码插入到程序中

编译器，翻译成汇编程序文本文件

汇编器，将汇编文本文件翻译成机器语言指令

链接阶段，printf已经单独预编译好了，链接器ld处理这种合并

18、编译器的一些疑问

switch总比if-else好吗？

while比for循环有效？

指针引用比数组索引更快？

循环求和结果放在本地变量会比索引对象上快？

19、总线传送定长字节块，也就是字，字中字节数是系统的参数，有四个字节32位，也有八个字节64位

20、键盘、鼠标、显示器以及磁盘，四个I/O设备，通过对应的控制器或者适配器与I/O总线相连。适配器和控制器的区别，在于控制器是I/O设备本身或者系统主板印刷电路版上的芯片组，而适配器是插在主板插槽上的卡。

21、主存，临时存储设备，在处理器处理程序的时候，存放程序和程序处理的数据。从逻辑上来说，主存是一个线性字节数组

22、cpu中央处理器，执行存储在主存的指令的引擎。不断执行程序计数器指向的指令，并更新程序计数器的指向。计算机一个字等于多少个字节，就看它是多少位的了。

过程：

加载，从主存加载一个字节或者一个字到寄存器，覆盖原来内容

存储，从寄存器加载一个字节或者一个字到主存，覆盖原来内容

操作，把两个寄存器的内容加载到ALU算术逻辑单元，ALU对这两个字进行算术计算，并将结果存储到一个寄存器中，覆盖原来内容

跳转，从指令本身抽取一个字，并将这个字复制到程序计数器PC中，覆盖原来的

23、运行hello更加详细的过程：

键盘输入: ".hello"，shell将它逐一字符读入寄存器，再把它存到内存中

回车后，shell程序知道我们已经结束了命令输入，然后执行一系列的指令来加载hello，将hello的代码和数据从磁盘复制到主存，最终输出结果。

24、直接存储器获取技术，无需经过CPU，后面会提到。

25、快速缓存，不难看出过程中有很多拷贝，都是开销。从机器上来说，从主存获取速度是从磁盘获取速度的1000倍。寄存器又被主存快100倍。高速缓存器速度和寄存器差不多，高速缓存实现了快速获取局部代码和数据的能力，某些程序可以利用高速缓存提高速度。

26、存储器层次结构，越大越慢越便宜。远程二级存储（分布式系统，web服务器） > 本地二级缓存（磁盘） > 主存DRAM > L3高速缓存 > L2高速缓存 > L1高速缓存 > 寄存器。上层可以当做下层的高速缓存。

27、操作系统管理硬件，shell和hello程序没有直接访问键盘、显示器、磁盘，而是通过操作提供的服务。操作系统可以看成是应用层序和硬件之间插入的一层软件。操作系统有两个功能：一、避免硬件被异常的程序滥用 二、向应用程序提供简单一致的机制控制复杂而又不相同的低级硬件设备。操作系统通过几个抽象概念（进程、虚拟内存和文件）来实现这两个功能。文件是对I/O设备的抽象，虚拟内存是对主存和I/O设备的抽象，进程是对处理器、主存、I/O设备的抽象。

28、一种假象：运行hello的时候，操作系统提供一种假象，好像只有该程序在独占处理器、主存和I/O设备。这些假象是通过进程这概念来实现的。

29、进程是操作系统对正在运行的程序的一种抽象。一个系统可以同时运行多个进程，但是看起来的话，就像每个进程是独占硬件。多程序并行运行，主要看的是有多少个CPU。不管是单核还是多核，一个CPU好像都在并行执行多个进程，这其实是通过处理器在多个进程中切换实现的，也叫做上下文切换。

30、操作系统保持跟踪进程运行所需的所有状态信息，也叫做上下文，例如PC和寄存器文件的当前值。切换的时候，保存当前上下文，恢复新进程的上下文，再将控制权传递到新进程。

31、上述例子的过程：当我们让shell运行hello的时候，shell通过调用一个专门的函数，也就是系统调用，来执行命令。系统调用会将控制器传递给操作系统，操作系统保存shell的上下文。创建新的hello进程和它的上下文，然后将控制权传递给hello进程。hello结束了后，操作系统恢复shell进程和上下文，并将控制权传递回给它。

32、进程切换，是通过操作系统内核来管理的。内核是操作系统代码常驻主存的一部分。当应用程序要操作系统的某些操作时，如读写文件，它就执行特殊的系统调用指令，将控制权传递给内核，内核执行被请求的操作并返回应用程序。内核不是独立的进程，它是系统管理全部进程所用代码和数据结构的集合。

33、进程是由多个称为线程的执行单元组成，线程运行在进程的上下文里，共享同样的代码和全局数据。多线程比多进程更加容易共享数据，多处理器可用的时候，多进程也是一种使程序运行更快的方法。

34、虚拟内存，为每个进程提供假象，即每个进程在独占主存。每个进程看到的内存都是一致的，称为虚拟地址空间。

35、Amdahl定律：要显著加速整个系统，需要提升系统中相当大的部分。